<!doctype html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Stock In - Current News</title>
    <link rel="stylesheet" href="/static/styles.css">
</head>
<body>
    <nav class="nav">
        <a href="/research.html">Research</a>
        <a href="/recents.html">Recents</a>
        <a href="/favourites.html">Favourites</a>
        <a href="/news.html">News</a>
    </nav>

    <main class="container">
        <h1>Current Financial News</h1>
        <div id="newsFeed">Loading categorized news...</div>
    </main>

<script>
    function formatDate(isoString) {
        if (!isoString) return '';
        const options = { year: 'numeric', month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' };
        return new Date(isoString).toLocaleDateString('en-US', options);
    }

    async function loadNewsFeed() {
        const root = document.getElementById('newsFeed');
        root.innerHTML = 'Fetching the latest headlines...';

        try {
            // --- UPDATED FETCH: Now a POST request ---
            const res = await fetch('/api/news_feed', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                // Sending an empty body or categories array
                body: JSON.stringify({ categories: ["technology", "business", "health", "energy"] }) 
            });
            // ------------------------------------------

            if (!res.ok) {
                root.innerHTML = 'Failed to load news feed. Check API Key.';
                return;
            }
            
            const j = await res.json();
            const categories = j.categories;
            
            let htmlContent = '';
            
            for (const category in categories) {
                const articles = categories[category];
                if (articles.length === 0) continue;

                const categoryTitle = category.charAt(0).toUpperCase() + category.slice(1);

                htmlContent += `
                    <h2>ðŸ“° ${categoryTitle}</h2>
                    <div class="news-category-section">
                        ${articles.map(article => `
                            <div class="news-card">
                                <h3><a href="${article.url}" target="_blank">${article.title}</a></h3>
                                <p class="summary">${article.description || 'No summary available.'}</p>
                                <div class="meta">
                                    <span class="source">${article.source}</span> â€” 
                                    <span class="date">${formatDate(article.publishedAt)}</span>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;
            }
            
            root.innerHTML = htmlContent || 'No news articles could be loaded.';

        } catch (error) {
            console.error('Error loading news:', error);
            root.innerHTML = 'An error occurred while connecting to the news service.';
        }
    }

    document.addEventListener('DOMContentLoaded', loadNewsFeed);
</script>
</body>
</html>